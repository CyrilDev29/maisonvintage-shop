{% extends 'base.html.twig' %}

{% block title %}{{ article.titre }} — Maisonvintage{% endblock %}

{% block body %}
    <section class="container" style="max-width:1100px;margin:2rem auto;padding:0 1rem;">
        <nav style="margin-bottom:1rem;font-size:.95rem;">
            <a href="{{ path('home') ?? '/' }}">Accueil</a>
            &nbsp;›&nbsp;
            <a href="{{ path('categorie_show', {slug: article.categorie.slug}) }}">{{ article.categorie.nom }}</a>
            &nbsp;›&nbsp;
            <span>{{ article.titre }}</span>
        </nav>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;">
            <div>
                {% if article.image %}
                    <img src="{{ asset('uploads/articles/' ~ article.image) }}"
                         alt="{{ article.titre }}"
                         style="width:100%;height:auto;border:1px solid #eee;border-radius:8px;">
                {% else %}
                    <div style="width:100%;aspect-ratio:4/3;background:#f7f7f7;border:1px solid #eee;border-radius:8px;"></div>
                {% endif %}
            </div>

            <div>
                <h1 style="margin:.25rem 0 1rem 0;">{{ article.titre }}</h1>

                {% if article.prix is not null %}
                    <div style="font-size:1.5rem;font-weight:700;margin-bottom:1rem;">
                        {{ article.prix|number_format(2, ',', ' ') }} €
                    </div>
                {% endif %}

                {% if article.quantity is not null %}
                    <div style="margin-bottom:.75rem;color:#444;">
                        Quantité disponible : {{ article.quantity }}
                    </div>
                {% endif %}

                {% if article.description %}
                    <div style="margin:1rem 0 1.5rem 0;line-height:1.6;">
                        {{ article.description|nl2br }}
                    </div>
                {% endif %}

                {# --- Bloc "Ajouter au panier" --- #}
                {% if article.quantity is defined and article.quantity > 0 %}
                    <form action="{{ path('cart_add', {id: article.id}) }}" method="post" style="margin:1rem 0 1.5rem 0;">
                        {% if article.quantity > 1 %}
                            <label for="qty" style="display:inline-block;margin-right:.5rem;">Quantité</label>
                            <input id="qty" name="qty" type="number" value="1" min="1" max="{{ article.quantity }}"
                                   style="width:90px;padding:.4rem;border:1px solid #ccc;border-radius:6px;margin-right:.5rem;">
                        {% else %}
                            {# 1 seule pièce : on force qty=1 et on n’affiche pas l’input #}
                            <input type="hidden" name="qty" value="1">
                        {% endif %}

                        <button type="submit"
                                style="padding:.6rem 1rem;border:1px solid #222;border-radius:8px;background:#222;color:#fff;">
                            Ajouter au panier
                        </button>
                    </form>
                {% else %}
                    <div style="margin:1rem 0 1.5rem 0;color:#a00;font-weight:600;">
                        Rupture de stock
                    </div>
                {% endif %}


                <a href="{{ path('categorie_show', {slug: article.categorie.slug}) }}"
                   style="display:inline-block;padding:.6rem 1rem;border:1px solid #222;border-radius:8px;text-decoration:none;">
                    ← Retour à {{ article.categorie.nom }}
                </a>
            </div>
        </div>
    </section>
{% endblock %}
